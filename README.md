# Lumen API

This is a rest api built with [Lumen](https://lumen.laravel.com/) and developed with docker environment [Vessel](https://vessel.shippingdocker.com/).

### Requirements

```
git
docker
docker-compose
```

### Install

Get the source.

```
$ git clone https://github.com/abeatrice/lumen-api.git
$ cd lumen-api
```

Initialize the development enviornment.

```
$ bash vessel init 
$ cp .env.example .env
```

Install the applications dependancies.

```
$ ./vessel composer install
```

Migrate and seed the database.

```
$ ./vessel artisan migrate:fresh --seed
```

### Tests

Run tests in the container.

```
$ ./vessel test
```

### Containers

Start the containers. The application will be running on port 80 at localhost.

```
$ ./vessel start
```

Stop the containers. This stops the application from running.

```
$ ./vessel stop
```

### Postman

You can interact with the rest api via [postman](https://www.getpostman.com/downloads/).

```
open postman
select import
select lumen-api.postman_collection.json from project root
select the collections tab to see a list of some examples on interacting with the api
```

### Middleware

Some actions require that you are logged in with a token. You can get a token by logging in or registering a user via the postman examples. You can then use the token that is returned on other requests by placing the token in the Authorization tab under type "Bearer Token". Other requests require that you are the owner of a resource. You can only see what flights you have booked.

```
auth - requires http request to include Bearer Token generated by /api/user/login
isOwner - requires authenticated user to be the requested resource owner
```

### API

#### Auth

| Verb      | Endpoint                              | Description                       | Middleware    |
|:--------- |:------------------------------------- |:--------------------------------- |:------------- |
| POST      | /api/user/register                    | register a new user               |               |
| POST      | /api/user/login                       | login a user & get a Bearer Token |               |

#### Flights

| Verb      | Endpoint                              | Description                       | Middleware    | Query Parameters          |
|:--------- |:------------------------------------- |:--------------------------------- |:------------- |:--------------------------|
| GET       | /api/flights                          | get all flights                   | auth          | ?departsAfter=2019-10-07  |
|           |                                       |                                   |               | ?departsBefore=2019-10-09 |
|           |                                       |                                   |               | ?origin=BUR               |
|           |                                       |                                   |               | ?destination=SEA          |
| GET       | /api/flights/{flightId}               | get one flight by id              | auth          |                           |

#### User Flights

| Verb      | Endpoint                              | Description                       | Middleware    |
|:--------- |:------------------------------------- |:--------------------------------- |:------------- |
| GET       | /api/user/{userId}/flights            | get user's flights                | auth, isOwner |
| POST      | /api/user/{userId}/flights            | assign flight to user             | auth, isOwner |
| DELETE    | /api/user/{userId}/flights/{flightId} | cancel user's flight              | auth, isOwner |
